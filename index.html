<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <title>Disk Manager</title>
        <link rel='stylesheet' type='text/css' media='screen' href='/addons/css/_style.css'>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
        <script>

            function BODY_onLoad(){
                {/* ---------------Bouttons-------------- */
                    loginButton = document.getElementById("loginButton");
                    logoutButton = document.getElementById("logoutButton");
                /* -------------------------------------- */}
                {/* ----------Info de connexion---------- */
                    usernameInput = document.getElementById("username");
                    passwordInput = document.getElementById("password");
                /* -------------------------------------- */}
                {/* ---------------Terminal-------------- */
                    terminalInput = document.getElementById("terminal-input");
                    terminalUser = document.getElementById("terminal_user");
                    terminalUser2 = document.getElementById("user");
                /* -------------------------------------- */}

            }


            function sendRequest(cmd, param1, param2, callback) {
                var xhr = new XMLHttpRequest();
                xhr.onload = function () {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        var responseText = xhr.responseText;
                        var responseObject = JSON.parse(responseText);
                        if (callback) {
                            callback(responseObject);
                        }
                    }
                };

                var formData = new FormData();
                formData.append('CMD', cmd);
                if (param1) {
                    formData.append('PARAM1', param1);
                }
                if (param2) {
                    formData.append('PARAM2', param2);
                }

                xhr.open('POST', 'disk.php');
                xhr.send(formData);
            }


            // Fonction pour gérer la réponse
            function handleResponse(responseObject) {
                var responseTextarea = document.getElementById('terminal-input');
                try {
                    if (typeof responseObject === 'object') {
                        responseTextarea.value = JSON.stringify(responseObject, null, 2);
                    } else {
                        responseTextarea.value = responseObject;
                    }
                } catch (error) {
                    console.error("Error parsing or handling response:", responseObject);
                    responseTextarea.value = "Error handling response";
                }
            }

            function cmd_action(cmd) {
                if (cmd == 'LOGIN') {
                    param1 = document.getElementById("username").value;

                    param2 = document.getElementById("password").value;
                    sendRequest(cmd, param1, param2, function (response) {
                        handleResponse(response);
                        terminalUser.textContent = terminalUser2.textContent = param1 + "@admin:";
                    });
                } else if (cmd == 'LOGOUT') {
                    
                    sendRequest(cmd, null, null, function (response) {
                        handleResponse(response);
                        terminalUser.textContent = terminalUser2.textContent = "Connectez-vous pour faire des actions";
                    });
                } else if (cmd == 'WHOAMI') {

                    sendRequest(cmd, null, null, function (response) {
                        handleResponse(response);
                    });
                } else if (cmd == 'DIR') {
                    sendRequest(cmd, null, null, function (response) {
                        handleResponse(response);
                    });
                } else if (cmd == 'CD1') {
                    sendRequest(cmd, null, null, function (response) {
                        handleDirectoryList(response);
                        console.log('TTTTT')
                    });
                }
            }
            function handleDirectoryList(response) {
                var modalBody = document.querySelector('.modal-body');
                modalBody.innerHTML = ''; // Effacer le contenu actuel du modal

                if (response.status === 'success') {
                    var directories = response.content;

                    // Créer une liste à puces pour afficher les répertoires dans le modal
                    var ul = document.createElement('ul');

                    // Ajouter un bouton ".." au début de la liste
                    var liDotDot = document.createElement('li');
                    var buttonDotDot = document.createElement('button');
                    buttonDotDot.textContent = '..';
                    buttonDotDot.addEventListener('click', function() {
                        // Ajouter ici l'action que vous souhaitez effectuer lorsque le bouton est cliqué
                        // Par exemple, remonter d'un niveau en appelant une fonction appropriée
                        console.log('Revenir au répertoire précédent');
                    });
                    liDotDot.appendChild(buttonDotDot);
                    ul.appendChild(liDotDot);

                    // Ajouter les boutons pour les répertoires
                    directories.forEach(function (directory) {
                        var li = document.createElement('li');

                        // Créer un bouton pour chaque répertoire
                        var button = document.createElement('button');
                        button.textContent = directory;
                        button.addEventListener('click', function() {
                            // Ajouter ici l'action que vous souhaitez effectuer lorsque le bouton est cliqué
                            // Par exemple, changer de répertoire en appelant une fonction appropriée
                            console.log('Changer de répertoire vers : ' + directory);
                        });

                        // Ajouter le bouton au li
                        li.appendChild(button);

                        // Ajouter le li à la liste à puces
                        ul.appendChild(li);
                    });

                    // Ajouter la liste à puces au modal
                    modalBody.appendChild(ul);

                    // Afficher le modal après l'ajout des éléments
                    var myModal = new bootstrap.Modal(document.getElementById('exampleModal'));
                    myModal.show();
                } else {
                    modalBody.textContent = response.message;
                }
            }


    

        </script>
    </head>
    <body onload="BODY_onLoad()">
        <div class="container">
            <div class="terminal_toolbar">
                <div class="butt">
                    <button class="btn btn-color"></button>
                    <button class="btn"></button>
                    <button class="btn"></button>
                </div>
                <div class="butt">
                    <input type="text" id="username" placeholder="Nom d'utilisateur" width="15px">
                    <input type="password" id="password" placeholder="Mot de passe"width="15px">
                    <button id="loginButton" onclick="cmd_action('LOGIN')">LOGIN</button>
                    <button id="logoutButton" onclick="cmd_action('LOGOUT')">LOGOUT</button>
                    <button onclick="cmd_action('WHOAMI')">WHOAMI</button>
                    <button onclick="cmd_action('DIR')">DIR</button>
                    <button data-bs-toggle="modal" data-bs-target="#exampleModal" onclick="cmd_action('CD1')">CD</button>
                </div>
                <p class="user" id="user">Connectez-vous pour faire des actions</p>
                <button class="add_tab">
                    +
                </button>
            </div>
            <div class="terminal_body">
                <div class="terminal_promt">
                    <span class="terminal_user" id="terminal_user"></span>
                    <span class="terminal_location">~</span>
                    <span class="terminal_bling">$</span>
                    <span class="terminal_cursor"></span>
                    <div style="display: flex; flex-direction: column;">
                        <!-- <textarea id="terminal-input2" heigth="10px"></textarea> -->
                        <textarea id="terminal-input" ></textarea>
                    </div>
                    
                </div>
            </div>
        </div>  
        
        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Change Directory</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
    
                </div>
            </div>
            </div>
        </div>
    </body>
</html>
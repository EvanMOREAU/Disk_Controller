<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <title>Disk Manager</title>
        <link rel='stylesheet' type='text/css' media='screen' href='_style.css'>
        <script>

            function BODY_onLoad(){
                {/* ---------------Bouttons-------------- */
                    loginButton = document.getElementById("loginButton");
                    logoutButton = document.getElementById("logoutButton");
                /* -------------------------------------- */}
                {/* ----------Info de connexion---------- */
                    usernameInput = document.getElementById("username");
                    passwordInput = document.getElementById("password");
                /* -------------------------------------- */}
                {/* ---------------Terminal-------------- */
                    terminalInput = document.getElementById("terminal-input");
                    terminalUser = document.getElementById("terminal_user");
                    terminalUser2 = document.getElementById("user");
                /* -------------------------------------- */}

            }


            function sendRequest(cmd, param1, param2, callback) {
                var xhr = new XMLHttpRequest();
                xhr.onload = function () {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        var responseText = xhr.responseText;
                        var responseObject = JSON.parse(responseText);
                        if (callback) {
                            callback(responseObject);
                        }
                    }
                };

                var formData = new FormData();
                formData.append('CMD', cmd);
                if (param1) {
                    formData.append('PARAM1', param1);
                }
                if (param2) {
                    formData.append('PARAM2', param2);
                }

                xhr.open('POST', 'disk.php');
                xhr.send(formData);
            }


            // Fonction pour gérer la réponse
            function handleResponse(responseObject) {
                var responseTextarea = document.getElementById('terminal-input');
                try {
                    if (typeof responseObject === 'object') {
                        responseTextarea.value = JSON.stringify(responseObject, null, 2);
                    } else {
                        responseTextarea.value = responseObject;
                    }
                } catch (error) {
                    console.error("Error parsing or handling response:", responseObject);
                    responseTextarea.value = "Error handling response";
                }
            }

            function cmd_action(cmd) {
                if (cmd == 'LOGIN') {
                    param1 = document.getElementById("username").value;

                    param2 = document.getElementById("password").value;
                    sendRequest(cmd, param1, param2, function (response) {
                        handleResponse(response);
                        terminalUser.textContent = terminalUser2.textContent = param1 + "@admin:";
                    });
                } else if (cmd == 'LOGOUT') {
                    
                    sendRequest(cmd, null, null, function (response) {
                        handleResponse(response);
                        terminalUser.textContent = terminalUser2.textContent = "Connectez-vous pour faire des actions";
                    });
                } else if (cmd == 'WHOAMI') {

                    sendRequest(cmd, null, null, function (response) {
                        handleResponse(response);
                    });
                } else if (cmd == 'DIR') {
                    sendRequest(cmd, null, null, function (response) {
                        handleResponse(response);
                    });
                }
            }
        </script>
    </head>
    <body onload="BODY_onLoad()">
        <div class="container">
            <div class="terminal_toolbar">
                <div class="butt">
                    <button class="btn btn-color"></button>
                    <button class="btn"></button>
                    <button class="btn"></button>
                </div>
                <div class="butt">
                    <input type="text" id="username" placeholder="Nom d'utilisateur" width="15px">
                    <input type="password" id="password" placeholder="Mot de passe"width="15px">
                    <button id="loginButton" onclick="cmd_action('LOGIN')">LOGIN</button>
                    <button id="logoutButton" onclick="cmd_action('LOGOUT')">LOGOUT</button>
                    <button onclick="cmd_action('WHOAMI')">WHOAMI</button>
                    <button onclick="cmd_action('DIR')">DIR</button>
                </div>
                <p class="user" id="user">Connectez-vous pour faire des actions</p>
                <button class="add_tab">
                    +
                </button>
            </div>
            <div class="terminal_body">
                <div class="terminal_promt">
                    <span class="terminal_user" id="terminal_user"></span>
                    <span class="terminal_location">~</span>
                    <span class="terminal_bling">$</span>
                    <span class="terminal_cursor"></span>
                    <div style="display: flex; flex-direction: column;">
                        <!-- <textarea id="terminal-input2" heigth="10px"></textarea> -->
                        <textarea id="terminal-input" ></textarea>
                    </div>
                    
                </div>
            </div>
        </div>   
    </body>
</html>